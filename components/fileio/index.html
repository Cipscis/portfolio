<html>
<head>
	<title>FileIO</title>

	<link rel="stylesheet" href="/portfolio/assets/css/style.css" />

	<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
	<div class="layout">
		<div class="content">
			<h1>FileIO</h1>

			<p>This provides methods for saving and loading files in the browser.</p>

			<h2>Load</h2>

			<p>To load files, FileIO creates an <code class="tag">input type="file"</code> element and triggers a click event on it, causing the browser to open a file dialogue. If the user selects a file, then that file is made available to a callback function.</p>

			<p>The format in which the file is made available depends on the method used.</p>

			<p>For images, the selected file is passed through as a data URL, which can then be set as the <code>src</code> attribute of an <code class="tag">img</code> tag to display the selected image:</p>

			<p><button class="o-btn js-load-image">Load Image</button></p>
		</div>

		<div class="panel">
			<img class="js-fileio-image" style="display: block; max-width: 100%;" />
		</div>

		<div class="content">
			<p>For text, the selected file's contents are passed through as a string.</p>

			<p>In this example, the selected file's contents are printed to the console. Don't pick a large file or one that isn't plain text, since the browser can take a long time to print the contents of a large file to the console.</p>

			<p><button class="button js-load-text">Load Text</button></p>

			<h2>Save</h2>

			<p>To save files, FileIO creates an <code class="tag">a</code> tag pointing to a data URL with a <code>download</code> attribute and triggers a click on it.</p>

			<p>For Microsoft browsers that don't support this method, <code>navigator.msSaveBlob</code> is used instead.</p>

			<p>Utility methods are available for saving certain JSON or CSV files based on JavaScript objects. There is also a method for saving arbitrary data, and methods for saving files that are in the form of a <code>Blob</code> or <code>File</code> object.</p>

			<p><button class="button js-save-data">Save some data</button></p>
			<p><button class="button js-save-json">Save JSON</button></p>
			<p><button class="button js-save-csv">Save a CSV</button></p>
		</div>
	</div>

	<script type="module">
		import fileIO from '/portfolio/assets/scripts/fileio.js';
		import activate from '/portfolio/assets/scripts/activate.js';

		var loadImage = (fileUrl) => {
			var $image = document.querySelectorAll('.js-fileio-image');
			$image.forEach(($image) => $image.src = fileUrl);
		};
		activate('.js-load-image', () => fileIO.load.image(loadImage));

		var loadText = (fileText) => console.log(fileText);
		activate('.js-load-text', () => fileIO.load.text(loadText));

		var saveData = () => {
			var data = 'Hey look, the file has some content!';
			var filename = 'test file.txt';
			var type = 'text/plain';

			fileIO.save.data(data, filename, type);
		};
		activate('.js-save-data', saveData);

		var saveJson = () => {
			var data = {
				text: 1,
				foo: 'bar'
			};
			var filename = 'test json';

			fileIO.save.json(data, filename);
		};
		activate('.js-save-json', saveJson);

		var saveCsv = () => {
			var data = [
				['even numbers', 0, 2, 4, 6, 8, 10],
				['odd numbers', 1, 3, 5, 7, 9],
				['prime numbers', 2, 3, 5, 7]
			];
			var filename = 'test csv';

			// The third parameter tells fileIO to transpose the data before saving it,
			// so it can be passed through at this point as columns instead of rows
			fileIO.save.csv(data, filename, true);
		};
		activate('.js-save-csv', saveCsv);
	</script>
</body>

</html>
