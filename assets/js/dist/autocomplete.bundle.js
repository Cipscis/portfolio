(()=>{"use strict";const e={},t=(function(e){const t="data-autohide-timeout",n={SUCCESS:"SUCCESS",ERROR:"ERROR"},i={[n.SUCCESS]:"success",[n.ERROR]:"error",hidden:"hidden"},s={_initSubscriptions:function(){e&&(e("/status/success",s.success),e("/status/error",s.error),e("/status/hide",s.hide))},_getEl:function(e){return"string"==typeof e?e=document.querySelector(e):e instanceof NodeList?e=e[0]:void 0===e&&(e=document.querySelector(".js-status")),e||console.error("No status element could be found"),e},_clearType:function(e){for(let t in n){let n=i[t];e.classList.contains(n)&&e.classList.remove(n)}},_setType:function(e,t){let n=i[e];n?(s._clearType(t),window.setTimeout((()=>t.classList.add(n)),10)):console.error("No CSS class is defined for status type "+e)},_clearMessage:function(e){e.textContent=""},_setMessage:function(e,t){s._clearMessage(t),window.setTimeout((()=>t.textContent=e),100)},_show:function(e,t,n,o){s._setType(t,n),s._setMessage(e,n),n.classList.remove(i.hidden),s._setAutohide(n,o)},_setAutohide:function(e,n){if(s._clearAutohide(e),n&&n>0){let i=window.setTimeout((()=>s.hide(e)),n);e.setAttribute(t,i)}},_clearAutohide:function(e){let n=e.getAttribute(t);n&&(window.clearTimeout(n),e.removeAttribute(t))},hide:function(e){(e=s._getEl(e)).classList.add(i.hidden),s._clearAutohide(e)},success:function(e,t,i){t=s._getEl(t),s._show(e,n.SUCCESS,t,i)},error:function(e,t,i){t=s._getEl(t),s._show(e,n.ERROR,t,i)}};s._initSubscriptions(),s.hide,s.success,s.error}((function(t,n){t in e||(e[t]=[]);let i=e[t];!1===i.includes(n)&&i.push(n)})),function(e,t){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{n=void 0,e.apply(this,arguments)}),t)}}),n=[],{activate:i,deactivate:s}=function(){const e={activate:function(t,n){e._activator(t,n,e._activateSingle)},deactivate:function(t,n){e._activator(t,n,e._deactivateSingle)},_activator:function(t,n,i){if("string"==typeof t)try{t=document.querySelectorAll(t)}catch(n){let s=i===e._deactivateSingle?"deactivate":"activate";throw new DOMException(`${s} failed because it was passed an invalid selector string: '${t}'`)}t instanceof Node?i(t,n):t.length&&t.forEach&&t.forEach((e=>i(e,n)))},_activateSingle:function(t,n){if(t instanceof Node==0)throw new TypeError("activate failed because a valid Node was not passed");if(!e._getNodeBindings(t,n)&&(t.addEventListener("click",n),!1===e._isNodeType(t,"button"))){!1===e._getNodeHasBindings(t)&&t.addEventListener("keydown",e._preventSpacebarScroll);let i=e._makeSpacebarFn(n);t.addEventListener("keyup",i);let s={spacebarFn:i};if(!1===e._isNodeType(t,"a")){let i=e._makeEnterFn(n);t.addEventListener("keydown",i),s.enterFn=i}e._rememberNodeBindings(t,n,s)}},_deactivateSingle:function(t,n){if(t instanceof Node==0)throw new TypeError("deactivate failed because a valid Node was not passed");let i=e._getNodeBindings(t,n);t.removeEventListener("click",n),i&&!1===e._isNodeType(t,"button")&&(t.removeEventListener("keyup",i.spacebarFn),!1===e._isNodeType(t,"a")&&t.removeEventListener("keydown",i.enterFn),e._forgetNodeBindings(t,n),!1===e._getNodeHasBindings(t)&&t.removeEventListener("keydown",e._preventSpacebarScroll))},_rememberNodeBindings:function(e,t,i){let s=n.find((t=>t.node===e));s||(s={node:e,bindings:[{fn:t}]},n.push(s));let o=s.bindings.find((e=>e.fn===t));o||(o={fn:t},s.bindings.push(o)),Object.assign(o,i)},_forgetNodeBindings:function(e,t){let i=n.find((t=>t.node===e));if(!i)return;let s=i.bindings.find((e=>e.fn===t));if(!s)return;let o=i.bindings.indexOf(s);i.bindings.splice(o,1)},_getNodeBindings:function(e,t){let i=n.find((t=>t.node===e));if(i)return i.bindings.find((e=>e.fn===t))||void 0},_getNodeHasBindings:function(e){return!!n.find((t=>t.node===e))},_makeEnterFn:function(t){return function(n){let i=e._isEnter(n);i&&t.apply(this,arguments)}},_isEnter:function(e){return e.key&&"enter"===e.key.toLowerCase()},_preventSpacebarScroll:function(t){let n=t.target,i=e._isNodeType(n,"button"),s=e._isNodeType(n,"input","textarea"),o=e._isSpacebar(t);i||s||!o||t.preventDefault()},_makeSpacebarFn:function(t){return function(n){let i=e._isSpacebar(n);i&&t.apply(this,arguments)}},_isSpacebar:function(e){return e.key&&(" "===e.key||"spacebar"===e.key.toLowerCase())},_isNodeType:function(e,...t){t=t.map((e=>e.toLowerCase()));let n=e.nodeName.toLowerCase();return t.includes(n)}};return{activate:e.activate,deactivate:e.deactivate}}();(function(e,t,n,i){const s=".js-autocomplete",o=".js-autocomplete__input",r=".js-autocomplete__result-list",u=".js-autocomplete__result-item",c=function(e){let t=window.getComputedStyle(e),n=t.visibility,i=t.display;return"hidden"!==n&&"none"!==i},l={init:function(e){void 0===e&&(e=s),"string"==typeof e&&(e=document.querySelectorAll(e)),e.length?e.forEach(l._initEl):l._initEl(e)},_initEl:function(e){let t=e.closest(s);l._initEvents(t)},_initEvents:function(e){e.addEventListener("focusout",l._onUnfocus(e)),e.addEventListener("focusin",l._onFocus(e)),e.addEventListener("keydown",l._hideResultsOnEsc(e));let t=e.querySelector(o);t.addEventListener("input",l._inputEvent),t.addEventListener("keydown",l._selectResultOnEnter),t.addEventListener("keydown",l._changeResultFocus)},_inputEvent:t((function(e){let t=this.closest(s);l._doQuery(t)}),500),_doQuery:function(e){let t=e.querySelector(o),n=e.getAttribute("data-autocomplete-source"),i=t.value;if(i.length>=3){let t=new XMLHttpRequest,s={query:i};t.onload=function(){try{if(200===this.status){let t=this.response,n=JSON.parse(t);l._querySuccess(e,n)}else l._queryError(e)}catch(t){l._queryError(e)}},t.open("GET",n),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(s))}else l._clearResults(e)},_buildResults:function(e,t){l._setResults(e,t),l._showResults(e)},_querySuccess:function(e,t){l._buildResults(e,t)},_queryError:function(e){let t=e.querySelector(".js-autocomplete__status");i&&i("/status/error","Sorry, something went wrong",t)},_setResults:function(e,t){let n=e.querySelector(r),i=l._getTemplate(e).innerHTML,s=l._buildResultsHtml(i,t);n.innerHTML=s,l._bindResultEvents(n)},_buildResultsHtml:function(t,n){return t=t.replace(/\r/g,""),e(t)(n)},_bindResultEvents:function(e){let t=e.querySelectorAll(u);t.forEach((e=>e.addEventListener("keydown",l._changeResultFocus))),n(t,l._selectResultEvent)},_clearResults:function(e){e.querySelector(r).innerHTML="",l._hideResults(e)},_showResults:function(e){let t=e.querySelector(o),n=e.querySelector(r),s=n.innerHTML;if(""!==s.trim()){if(n.innerHTML="",n.style.display="block",t.setAttribute("aria-expanded",!0),i){let e=n.querySelectorAll(u).length;i("/assist/speak",e+" results")}window.setTimeout((()=>{n.innerHTML=s,l._bindResultEvents(n)}),100)}},_hideResults:function(e){let t=e.querySelector(r),n=e.querySelector(o);t.style.display="none",n.setAttribute("aria-expanded",!1),l._removeResultFocus(e)},_hideResultsOnEsc:function(e){return function(t){"escape"===t.key.toLowerCase()&&l._hideResults(e)}},_onUnfocus:function(e){return function(t){t.target,window.setTimeout((function(){let t=document.activeElement.closest(s)===e,n=l._getFocusEl(e);!1===t&&(n.closest(u)?l._selectResult(n,!1):l._hideResults(e))}),1)}},_onFocus:function(e){return function(t){let n=l._getFocusEl(e),i=e.querySelector(r),o=n.closest(s)===e,u=c(i),a=""!==i.innerHTML.trim();o&&!u&&a&&l._showResults(e)}},_getTemplate:function(e){let t=e.querySelector(".js-autocomplete__template");if(0===t.length){let n=e.getAttribute("data-autocomplete-template-id");t=document.getElementById(n)}return t},_selectResultEvent:function(e){let t=e.target.closest(s),n=e.target.closest(u);if(!n){let e=t.querySelectorAll(u);n=Array.prototype.find.call(e,(e=>"true"===e.getAttribute("aria-selected")))}n&&!1!==n.matches(u)||(n=l._getFocusEl(t)),n&&n.matches(u)&&(e.preventDefault(),l._selectResult(n,!0))},_selectResultOnEnter:function(e){"enter"===e.key.toLowerCase()&&l._selectResultEvent(e)},_selectResult:function(e,t){let n=e.closest(s),i=(n.querySelector(r),n.querySelector(o));i.value=e.getAttribute("data-autocomplete-value"),t&&i.focus(),l._clearResults(n)},_changeResultFocus:function(e){let t,n=e.key.toLowerCase(),i=e.target.closest(s),o=i.querySelector(r),a=i.querySelectorAll(u);if(!a.length)return;if("arrowup"===n||"up"===n){if(e.altKey&&!0===c(a[0]))return void l._hideResults(i);t=-1}else{if("arrowdown"!==n&&"down"!==n)return void("arrowleft"!==n&&"left"!==n&&"arrowright"!==n&&"right"!==n&&"home"!==n&&"end"!==n||l._removeResultFocus(i));if(e.altKey&&!1===c(o))return void l._showResults(i);t=1}e.preventDefault();let d=l._getFocusEl(i).closest(u),f=Array.prototype.indexOf.call(a,d)+t||0;f<0?f=a.length-1:f>=a.length&&(f%=a.length),d=a[f],l._setResultFocus(d)},_setResultFocus:function(e){let t=e.closest(s),n=t.querySelector(o);t.querySelectorAll(u).forEach((t=>{t!==e&&t.setAttribute("aria-selected",!1)})),n.setAttribute("aria-activedescendant",e.getAttribute("id")),e.setAttribute("aria-selected",!0)},_removeResultFocus:function(e){let t=e.querySelector(o),n=e.querySelectorAll(u);t.removeAttribute("aria-activedescendant"),n.forEach((e=>e.setAttribute("aria-selected",!1)))},_getFocusEl:function(e){let t,n=e.querySelector(o).getAttribute("aria-activedescendant");return n&&(t=document.getElementById(n)),n&&0!==t.length||(t=document.activeElement),t}};return{init:l.init}})(templayed,t,i,(function(t,...n){t in e&&e[t].forEach((e=>{e.apply(null,n)}))})).init()})();
//# sourceMappingURL=autocomplete.bundle.js.map