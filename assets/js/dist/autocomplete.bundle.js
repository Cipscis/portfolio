(()=>{"use strict";const e={},t=e=>e.split(/\s+/).filter((e=>!!e)),n=function(s,...o){const i=t(s);if(i.length>1)for(const e of i)n.call(this,e,...o);else s in e&&e[s].forEach((e=>{e.apply(null,o)}))},s=function(n,o){const i=t(n);if(i.length>1)for(const e of i)s(e,o);else{n in e||(e[n]=[]);const t=e[n];!1===t.includes(o)&&t.push(o)}},o=(function(e){const t="data-autohide-timeout",n={SUCCESS:"SUCCESS",ERROR:"ERROR"},s={[n.SUCCESS]:"success",[n.ERROR]:"error",hidden:"hidden"},o={_initSubscriptions:function(){e&&(e("/status/success",o.success),e("/status/error",o.error),e("/status/hide",o.hide))},_getEl:function(e){return"string"==typeof e?e=document.querySelector(e):e instanceof NodeList?e=e[0]:void 0===e&&(e=document.querySelector(".js-status")),e||console.error("No status element could be found"),e},_clearType:function(e){for(let t in n){let n=s[t];e.classList.contains(n)&&e.classList.remove(n)}},_setType:function(e,t){let n=s[e];n?(o._clearType(t),window.setTimeout((()=>t.classList.add(n)),10)):console.error("No CSS class is defined for status type "+e)},_clearMessage:function(e){e.textContent=""},_setMessage:function(e,t){o._clearMessage(t),window.setTimeout((()=>t.textContent=e),100)},_show:function(e,t,n,i){o._setType(t,n),o._setMessage(e,n),n.classList.remove(s.hidden),o._setAutohide(n,i)},_setAutohide:function(e,n){if(o._clearAutohide(e),n&&n>0){let s=window.setTimeout((()=>o.hide(e)),n);e.setAttribute(t,s)}},_clearAutohide:function(e){let n=e.getAttribute(t);n&&(window.clearTimeout(n),e.removeAttribute(t))},hide:function(e){(e=o._getEl(e)).classList.add(s.hidden),o._clearAutohide(e)},success:function(e,t,s){t=o._getEl(t),o._show(e,n.SUCCESS,t,s)},error:function(e,t,s){t=o._getEl(t),o._show(e,n.ERROR,t,s)}};o._initSubscriptions(),o.hide,o.success,o.error}(s),function(e,t){let n,s,o;return function(...i){const r=r=>{n&&clearTimeout(n),n=setTimeout((()=>{n=void 0,s=void 0,o=void 0,r(e.apply(this,i))}),t)};return o?r(o):s=new Promise(((e,t)=>{o=e,r(o)})),s}}),i=new Map;function r(e,t,n){if("string"==typeof e)try{e=document.querySelectorAll(e)}catch(t){throw new DOMException(`${n===l?"deactivate":"activate"} failed because it was passed an invalid selector string: '${e}'`)}e instanceof HTMLElement?n(e,t):e.forEach((e=>n(e,t)))}function u(e,t){if(!(e instanceof HTMLElement))throw new TypeError("activate failed because a valid HTMLElement was not passed");if(!(c(e,t)||(e.addEventListener("click",t),e instanceof HTMLButtonElement))){!1===a(e)&&e.addEventListener("keydown",d);const n=function(e){return function(t){if(f(t))return e.call(this,t)}}(t);e.addEventListener("keyup",n);const s={spacebarFn:n};if(!(e instanceof HTMLAnchorElement)){const n=function(e){return function(t){if(function(e){return!(!e.key||"enter"!==e.key.toLowerCase())}(t))return e.call(this,t)}}(t);e.addEventListener("keydown",n),s.enterFn=n}!function(e,t,n){let s=i.get(e);s||(s=new Map([[t,n]]),i.set(e,s));let o=s.get(t);o?Object.assign(o,n):(o=Object.assign({},n),s.set(t,o))}(e,t,s)}}function l(e,t){if(!(e instanceof HTMLElement))throw new TypeError("deactivate failed because a valid HTMLElement was not passed");e.removeEventListener("click",t);const n=c(e,t);n&&(e instanceof HTMLButtonElement||(n.spacebarFn&&e.removeEventListener("keyup",n.spacebarFn),e instanceof HTMLAnchorElement||n.enterFn&&e.removeEventListener("keydown",n.enterFn),function(e,t){const n=i.get(e);n&&(n.delete(t),i.delete(e))}(e,t),!1===a(e)&&e.removeEventListener("keydown",d)))}function c(e,t){const n=i.get(e);if(n)return n.get(t)}function a(e){return i.has(e)}function d(e){const t=this,n=t instanceof HTMLButtonElement,s=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement,o=f(e);n||s||!o||e.preventDefault()}function f(e){return!(!e.key||" "!==e.key&&"spacebar"!==e.key.toLowerCase())}(function(e,t,n,s){const o=".js-autocomplete",i=".js-autocomplete__input",r=".js-autocomplete__result-list",u=".js-autocomplete__result-item",l=function(e){let t=window.getComputedStyle(e),n=t.visibility,s=t.display;return"hidden"!==n&&"none"!==s},c={init:function(e){void 0===e&&(e=o),"string"==typeof e&&(e=document.querySelectorAll(e)),e.length?e.forEach(c._initEl):c._initEl(e)},_initEl:function(e){let t=e.closest(o);c._initEvents(t)},_initEvents:function(e){e.addEventListener("focusout",c._onUnfocus(e)),e.addEventListener("focusin",c._onFocus(e)),e.addEventListener("keydown",c._hideResultsOnEsc(e));let t=e.querySelector(i);t.addEventListener("input",c._inputEvent),t.addEventListener("keydown",c._selectResultOnEnter),t.addEventListener("keydown",c._changeResultFocus)},_inputEvent:t((function(e){let t=this.closest(o);c._doQuery(t)}),500),_doQuery:function(e){let t=e.querySelector(i),n=e.getAttribute("data-autocomplete-source"),s=t.value;if(s.length>=3){let t=new XMLHttpRequest,o={query:s};t.onload=function(){try{if(200===this.status){let t=this.response,n=JSON.parse(t);c._querySuccess(e,n)}else c._queryError(e)}catch(t){c._queryError(e)}},t.open("GET",n),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(o))}else c._clearResults(e)},_buildResults:function(e,t){c._setResults(e,t),c._showResults(e)},_querySuccess:function(e,t){c._buildResults(e,t)},_queryError:function(e){let t=e.querySelector(".js-autocomplete__status");s&&s("/status/error","Sorry, something went wrong",t)},_setResults:function(e,t){let n=e.querySelector(r),s=c._getTemplate(e).innerHTML,o=c._buildResultsHtml(s,t);n.innerHTML=o,c._bindResultEvents(n)},_buildResultsHtml:function(t,n){return t=t.replace(/\r/g,""),e(t)(n)},_bindResultEvents:function(e){let t=e.querySelectorAll(u);t.forEach((e=>e.addEventListener("keydown",c._changeResultFocus))),n(t,c._selectResultEvent)},_clearResults:function(e){e.querySelector(r).innerHTML="",c._hideResults(e)},_showResults:function(e){let t=e.querySelector(i),n=e.querySelector(r),o=n.innerHTML;if(""!==o.trim()){if(n.innerHTML="",n.style.display="block",t.setAttribute("aria-expanded",!0),s){let e=n.querySelectorAll(u).length;s("/assist/speak",e+" results")}window.setTimeout((()=>{n.innerHTML=o,c._bindResultEvents(n)}),100)}},_hideResults:function(e){let t=e.querySelector(r),n=e.querySelector(i);t.style.display="none",n.setAttribute("aria-expanded",!1),c._removeResultFocus(e)},_hideResultsOnEsc:function(e){return function(t){"escape"===t.key.toLowerCase()&&c._hideResults(e)}},_onUnfocus:function(e){return function(t){t.target,window.setTimeout((function(){let t=document.activeElement.closest(o)===e,n=c._getFocusEl(e);!1===t&&(n.closest(u)?c._selectResult(n,!1):c._hideResults(e))}),1)}},_onFocus:function(e){return function(t){let n=c._getFocusEl(e),s=e.querySelector(r),i=n.closest(o)===e,u=l(s),a=""!==s.innerHTML.trim();i&&!u&&a&&c._showResults(e)}},_getTemplate:function(e){let t=e.querySelector(".js-autocomplete__template");if(0===t.length){let n=e.getAttribute("data-autocomplete-template-id");t=document.getElementById(n)}return t},_selectResultEvent:function(e){let t=e.target.closest(o),n=e.target.closest(u);if(!n){let e=t.querySelectorAll(u);n=Array.prototype.find.call(e,(e=>"true"===e.getAttribute("aria-selected")))}n&&!1!==n.matches(u)||(n=c._getFocusEl(t)),n&&n.matches(u)&&(e.preventDefault(),c._selectResult(n,!0))},_selectResultOnEnter:function(e){"enter"===e.key.toLowerCase()&&c._selectResultEvent(e)},_selectResult:function(e,t){let n=e.closest(o),s=(n.querySelector(r),n.querySelector(i));s.value=e.getAttribute("data-autocomplete-value"),t&&s.focus(),c._clearResults(n)},_changeResultFocus:function(e){let t,n=e.key.toLowerCase(),s=e.target.closest(o),i=s.querySelector(r),a=s.querySelectorAll(u);if(!a.length)return;if("arrowup"===n||"up"===n){if(e.altKey&&!0===l(a[0]))return void c._hideResults(s);t=-1}else{if("arrowdown"!==n&&"down"!==n)return void("arrowleft"!==n&&"left"!==n&&"arrowright"!==n&&"right"!==n&&"home"!==n&&"end"!==n||c._removeResultFocus(s));if(e.altKey&&!1===l(i))return void c._showResults(s);t=1}e.preventDefault();let d=c._getFocusEl(s).closest(u),f=Array.prototype.indexOf.call(a,d)+t||0;f<0?f=a.length-1:f>=a.length&&(f%=a.length),d=a[f],c._setResultFocus(d)},_setResultFocus:function(e){let t=e.closest(o),n=t.querySelector(i);t.querySelectorAll(u).forEach((t=>{t!==e&&t.setAttribute("aria-selected",!1)})),n.setAttribute("aria-activedescendant",e.getAttribute("id")),e.setAttribute("aria-selected",!0)},_removeResultFocus:function(e){let t=e.querySelector(i),n=e.querySelectorAll(u);t.removeAttribute("aria-activedescendant"),n.forEach((e=>e.setAttribute("aria-selected",!1)))},_getFocusEl:function(e){let t,n=e.querySelector(i).getAttribute("aria-activedescendant");return n&&(t=document.getElementById(n)),n&&0!==t.length||(t=document.activeElement),t}};return{init:c.init}})(templayed,o,(function(e,t){r(e,t,u)}),n).init()})();
//# sourceMappingURL=autocomplete.bundle.js.map