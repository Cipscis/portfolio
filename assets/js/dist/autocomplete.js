(()=>{"use strict";const e=new Map;function t(e,t,n){if("string"==typeof e)try{e=document.querySelectorAll(e)}catch(t){throw new DOMException(`${n===s?"deactivate":"activate"} failed because it was passed an invalid selector string: '${e}'`)}e instanceof HTMLElement?n(e,t):e.forEach((e=>n(e,t)))}function n(t,n){if(!(t instanceof HTMLElement))throw new TypeError("activate failed because a valid HTMLElement was not passed");if(!(o(t,n)||(t.addEventListener("click",n),t instanceof HTMLButtonElement))){!1===r(t)&&t.addEventListener("keydown",l);const s=function(e){return function(t){if(i(t))return e.call(this,t)}}(n);t.addEventListener("keyup",s);const o={spacebarFn:s};if(!(t instanceof HTMLAnchorElement)){const e=function(e){return function(t){const n=function(e){return!(!e.key||"enter"!==e.key.toLowerCase())}(t);if(n)return e.call(this,t)}}(n);t.addEventListener("keydown",e),o.enterFn=e}!function(t,n,s){let o=e.get(t);o||(o=new Map([[n,s]]),e.set(t,o));let r=o.get(n);r?Object.assign(r,s):(r=Object.assign({},s),o.set(n,r))}(t,n,o)}}function s(t,n){if(!(t instanceof HTMLElement))throw new TypeError("deactivate failed because a valid HTMLElement was not passed");t.removeEventListener("click",n);const s=o(t,n);s&&(t instanceof HTMLButtonElement||(s.spacebarFn&&t.removeEventListener("keyup",s.spacebarFn),t instanceof HTMLAnchorElement||s.enterFn&&t.removeEventListener("keydown",s.enterFn),function(t,n){const s=e.get(t);s&&(s.delete(n),e.delete(t))}(t,n),!1===r(t)&&t.removeEventListener("keydown",l)))}function o(t,n){const s=e.get(t);if(s)return s.get(n)}function r(t){return e.has(t)}function l(e){const t=this,n=t instanceof HTMLButtonElement,s=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement,o=i(e);n||s||!o||e.preventDefault()}function i(e){return!(!e.key||" "!==e.key&&"spacebar"!==e.key.toLowerCase())}const u={},c=function(e,...t){const n=e.split(/\s+/).filter((e=>!!e));if(n.length>1)for(const e of n)c.call(this,e,...t);else e in u&&u[e].forEach((e=>{e.apply(null,t)}))},a=function(e,t,n,s){const o=".js-autocomplete",r=".js-autocomplete__input",l=".js-autocomplete__result-list",i=".js-autocomplete__result-item",u=function(e){let t=window.getComputedStyle(e),n=t.visibility,s=t.display;return"hidden"!==n&&"none"!==s},c={init:function(e){void 0===e&&(e=o),"string"==typeof e&&(e=document.querySelectorAll(e)),e.length?e.forEach(c._initEl):c._initEl(e)},_initEl:function(e){let t=e.closest(o);c._initEvents(t)},_initEvents:function(e){e.addEventListener("focusout",c._onUnfocus(e)),e.addEventListener("focusin",c._onFocus(e)),e.addEventListener("keydown",c._hideResultsOnEsc(e));let t=e.querySelector(r);t.addEventListener("input",c._inputEvent),t.addEventListener("keydown",c._selectResultOnEnter),t.addEventListener("keydown",c._changeResultFocus)},_inputEvent:t((function(e){let t=this.closest(o);c._doQuery(t)}),500),_doQuery:function(e){let t=e.querySelector(r),n=e.getAttribute("data-autocomplete-source"),s=t.value;if(s.length>=3){let t=new XMLHttpRequest,o={query:s};t.onload=function(){try{if(200===this.status){let t=this.response,n=JSON.parse(t);c._querySuccess(e,n)}else c._queryError(e)}catch(t){c._queryError(e)}},t.open("GET",n),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(o))}else c._clearResults(e)},_buildResults:function(e,t){c._setResults(e,t),c._showResults(e)},_querySuccess:function(e,t){c._buildResults(e,t)},_queryError:function(e){let t=e.querySelector(".js-autocomplete__status");s&&s("/status/error","Sorry, something went wrong",t)},_setResults:function(e,t){let n=e.querySelector(l),s=c._getTemplate(e).innerHTML,o=c._buildResultsHtml(s,t);n.innerHTML=o,c._bindResultEvents(n)},_buildResultsHtml:function(t,n){return t=t.replace(/\r/g,""),e(t)(n)},_bindResultEvents:function(e){let t=e.querySelectorAll(i);t.forEach((e=>e.addEventListener("keydown",c._changeResultFocus))),n(t,c._selectResultEvent)},_clearResults:function(e){e.querySelector(l).innerHTML="",c._hideResults(e)},_showResults:function(e){let t=e.querySelector(r),n=e.querySelector(l),o=n.innerHTML;if(""!==o.trim()){if(n.innerHTML="",n.style.display="block",t.setAttribute("aria-expanded",!0),s){let e=n.querySelectorAll(i).length;s("/assist/speak",e+" results")}window.setTimeout((()=>{n.innerHTML=o,c._bindResultEvents(n)}),100)}},_hideResults:function(e){let t=e.querySelector(l),n=e.querySelector(r);t.style.display="none",n.setAttribute("aria-expanded",!1),c._removeResultFocus(e)},_hideResultsOnEsc:function(e){return function(t){"escape"===t.key.toLowerCase()&&c._hideResults(e)}},_onUnfocus:function(e){return function(t){window.setTimeout((function(){let t=document.activeElement.closest(o)===e,n=c._getFocusEl(e);!1===t&&(n.closest(i)?c._selectResult(n,!1):c._hideResults(e))}),1)}},_onFocus:function(e){return function(t){let n=c._getFocusEl(e),s=e.querySelector(l),r=n.closest(o)===e,i=u(s),a=""!==s.innerHTML.trim();r&&!i&&a&&c._showResults(e)}},_getTemplate:function(e){let t=e.querySelector(".js-autocomplete__template");if(0===t.length){let n=e.getAttribute("data-autocomplete-template-id");t=document.getElementById(n)}return t},_selectResultEvent:function(e){let t=e.target.closest(o),n=e.target.closest(i);if(!n){let e=t.querySelectorAll(i);n=Array.prototype.find.call(e,(e=>"true"===e.getAttribute("aria-selected")))}n&&!1!==n.matches(i)||(n=c._getFocusEl(t)),n&&n.matches(i)&&(e.preventDefault(),c._selectResult(n,!0))},_selectResultOnEnter:function(e){"enter"===e.key.toLowerCase()&&c._selectResultEvent(e)},_selectResult:function(e,t){let n=e.closest(o),s=n.querySelector(r);s.value=e.getAttribute("data-autocomplete-value"),t&&s.focus(),c._clearResults(n)},_changeResultFocus:function(e){let t,n=e.key.toLowerCase(),s=e.target.closest(o),r=s.querySelector(l),a=s.querySelectorAll(i);if(!a.length)return;if("arrowup"===n||"up"===n){if(e.altKey&&!0===u(a[0]))return void c._hideResults(s);t=-1}else{if("arrowdown"!==n&&"down"!==n)return void("arrowleft"!==n&&"left"!==n&&"arrowright"!==n&&"right"!==n&&"home"!==n&&"end"!==n||c._removeResultFocus(s));if(e.altKey&&!1===u(r))return void c._showResults(s);t=1}e.preventDefault();let d=c._getFocusEl(s).closest(i),f=Array.prototype.indexOf.call(a,d)+t||0;f<0?f=a.length-1:f>=a.length&&(f%=a.length),d=a[f],c._setResultFocus(d)},_setResultFocus:function(e){let t=e.closest(o),n=t.querySelector(r);t.querySelectorAll(i).forEach((t=>{t!==e&&t.setAttribute("aria-selected",!1)})),n.setAttribute("aria-activedescendant",e.getAttribute("id")),e.setAttribute("aria-selected",!0)},_removeResultFocus:function(e){let t=e.querySelector(r),n=e.querySelectorAll(i);t.removeAttribute("aria-activedescendant"),n.forEach((e=>e.setAttribute("aria-selected",!1)))},_getFocusEl:function(e){let t,n=e.querySelector(r).getAttribute("aria-activedescendant");return n&&(t=document.getElementById(n)),n&&0!==t.length||(t=document.activeElement),t}};return{init:c.init}}(templayed,(function(e,t){let n,s,o;return function(...r){const l=l=>{n&&clearTimeout(n),n=setTimeout((()=>{n=void 0,s=void 0,o=void 0,l(e.apply(this,r))}),t)};return o?l(o):s=new Promise(((e,t)=>{o=e,l(o)})),s}}),(function(e,s){t(e,s,n)}),c);a.init()})();
//# sourceMappingURL=autocomplete.js.map